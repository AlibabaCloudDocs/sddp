# 静态脱敏配置 {#concept_996210 .concept}

SDDP支持对敏感数据进行脱敏，对您项目中的敏感数据进行保护。

数据脱敏功能通过脱敏算法，对敏感数据进行遮盖、加密或者替换，在保证数据的可用性的同时，也保证了数据的安全。目前，SDDP仅支持静态脱敏。

**说明：** 目前脱敏任务仅适用于RDS和MaxCompute，OSS不支持。

## 前提条件 {#section_lx0_cll_h39 .section}

在对敏感数据进行脱敏前，需确认：

-   已完成了SDDP对数据所在项目的访问授权。
-   已配置了敏感定义规则。

## 操作步骤 {#section_59w_f14_smg .section}

1.  登录[敏感数据保护控制台](https://yundunnext-pre.console.aliyun.com/?p=sddp&accounttraceid=8c6b3535-f65e-4ef2-a2ac-744be5154805#/overview)。
2.  创建脱敏任务。

    在**敏感数据脱敏** \> **静态脱敏配置**页面，单击右上角**新增脱敏任务**创建自定义的脱敏任务。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803840/156318064451130_zh-CN.png)

    1.  填写**任务基本信息**，并单击**下一步**。

        **说明：** 任务名称输入不受限制。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803840/156318064451131_zh-CN.png)

    2.  配置脱敏数据的来源文件信息，并单击**下一步**。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803840/156318064451132_zh-CN.png)

        |脱敏源配置项|配置描述|
        |------|----|
        |源产品|选择包含脱敏数据的文件所来源的产品名称。 **说明：** 目前脱敏任务仅适用于RDS和MaxCompute，OSS不支持。

 |
        |项目选择|必选项。勾选包含脱敏数据的表所在的项目名称。|
        |表名|必选项。勾选脱敏数据所在的数据表名称。 **说明：** **源产品**选择RDS时，无需配置**表名**。

 |
        |源分区|选填项。手动输入需要脱敏的数据在数据表中的分区名称，分区写法参见[分区写法参考](#section_cjr_9pz_lq0)。 **说明：** **源产品**选择RDS时，无需配置**源分区**。

 [分区](../../../../cn.zh-CN/产品简介/基本概念/分区.md#)是指在创建MaxCompute数据表时指定的分区空间，用于限定不同区域，方便快速和高效地对指定内容进行查询。

 **说明：** **源分区**为选填项，不填写则代表会对整个表中的敏感数据进行脱敏。

 |
        |抽样SQL|选填项。手动输入SQL语句可选择脱敏数据范围。 **说明：** **源产品**选择MaxCompute时，无需配置**抽样SQL**。

 |

    3.  配置脱敏算法，并单击**下一步**。

        在脱敏算法配置表格中，对需要进行脱敏的源字段开启**脱敏开关**。

        **说明：** 脱敏开关未开启，将无法对数据进行脱敏。

    4.  将敏感文件移动到配置的目标位置，并单击**下一步**。
    5.  确认处理逻辑。

        |目标位置配置项|配置项描述|
        |-------|-----|
        |触发方式选择|触发方式表示执行脱敏任务的方式。可选项 ：         -   仅人工：需要在静态脱敏配置页面，通过手动的方式启动脱敏任务。
        -   仅定时触发：通过设置的时间点定时自动执行脱敏任务，可选每小时/每天/每月固定时间点自动触发任务。
        -   人工+定时触发：通过设置的时间，只能在该时间点手动执行脱敏任务，可选每小时/每天/每月固定时间点自动触发任务。
 |
        |表名冲突解决|表名称存在冲突的情况下处理的方式。可选项：         -   删除目标表建新同名表
        -   在目标表增加新数据：建议选择该选项。
 |
        |行冲突解决|         -   保留目标表冲突行，丢弃新插入数据：建议选择该选项。
        -   删除目标表冲突行，新插入新增数据
 |

    6.  单击**提交**，完成脱敏任务的创建。
3.  执行脱敏任务。

    脱敏任务创建完成后，在脱敏任务列表中右侧单击开启按钮![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803840/156318064551363_zh-CN.png)并单击**启动**，开始执行脱敏任务。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803840/156318064551248_zh-CN.png)

    创建好的脱敏任务支持修改和删除。在执行中的脱敏任务不支持删除。

4.  在任务执行查询列表中，查看脱敏任务的**执行进度**和**状态**。

    **状态**会展示该脱敏任务是否已执行成功或执行失败。执行失败的原因参见[脱敏任务执行失败排查](#section_eq7_qqb_ahn)。

    脱敏任务启动后，需手动单击**全局任务执行检索**，更新最新任务执行情况。未单击**全局任务执行检索**的情况下，在任务执行查询列表当前页中您可能无法看到该任务执行记录。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803840/156318064551249_zh-CN.png)


## 分区写法参考 {#section_cjr_9pz_lq0 .section}

|分区类型|分区写法|分区示例|
|----|----|----|
|后N周|自定义分区字段名称=$\[yyyymmdd+7\*N\]|time=$\[20190710+7\*1\]，表示对2019年7月10日后一周的数据进行脱敏。|
|前N周|自定义分区字段名称=$\[yyyymmdd-7\*N\]|time=$\[20190710-7\*3\]，表示对2019年7月10日前的3周时间内的数据进行脱敏。|
|后N天|自定义分区字段名称=$\[yyyymmdd+N\]|time=$\[20190710+2\]，表示对2019年7月10日后的2天内的数据进行脱敏。|
|前N天|自定义分区字段名称=$\[yyyymmdd-N\]|time=$\[20190710-5\]，表示对2019年7月10日前的5天内的数据进行脱敏。|
|后N小时|自定义分区字段名称=$\[hh24mi:ss+N/24\]|time=$\[0924mi:ss+N/24\]，表示对2019年7月10日后的2天内的数据进行脱敏。|
|前N小时|自定义分区字段名称=$\[hh24mi:ss-N/24\]|time=$\[0924mi:ss-1/24\]，表示对9点前的1个小时内的数据进行脱敏。|
|后N分钟|自定义分区字段名称=$\[hh24mi:ss+N/24/60\]|time=$\[0924mi:ss+2/24/60\]，表示对9点过后的2分钟内的数据进行脱敏。|
|前N分钟|自定义分区字段名称=$\[hh24mi:ss-N/24/60\]|time=$\[0924mi:ss-2/24/60\]，表示对9点的前2分钟内的数据进行脱敏。|

## 脱敏任务检索 {#section_q7n_x0d_ec2 .section}

您可在**静态脱敏配置**页面，对创建的脱敏任务进行查询。在任务列表中单击**任务编号**，可展开任务详情页面信息。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803840/156318064551343_zh-CN.png)

如需对某个已创建的任务进行修改，您可将该任务的任务编号复制到**脱敏任务列表**搜索栏中，并单击**脱敏任务检索**，筛选出该脱敏任务进行修改。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803840/156318064651345_zh-CN.png)

## 脱敏任务执行失败排查 {#section_eq7_qqb_ahn .section}

|执行失败错误提示|说明|
|--------|--|
|找不到脱敏任务，有可能是因为任务已经被删除或者关闭|脱敏任务可能被删除或被关闭（**脱敏任务列表**中**操作**栏关闭按钮未开启）。|
|定时任务的调度周期设置有误|每日具体任务执行时间输入有误。|
|找不到脱敏源实例|脱敏源表实例不存在。|
|找不到脱敏目标实例|可能的原因有实例授权取消或目标实例删除等。|
|找不到脱敏源表|可能的原因有实例授权取消、源表删除等。|
|脱敏算法参数设置有误|算法参数填写错误。|
|源表列为空|源分区字段的列没有数据。|
|写入目标表失败|目标位置配置时写入目标表失败。|
|从源表查询失败|源表中未查询到该数据。|
|创建目标表失败|目标位置中可能不存在该表格。|
|找不到主键|RDS源表缺少主键。有关主键详细内容，参见[RDS for MySQL查看表的主键字段的方法](../../../../cn.zh-CN/常见问题/数据库__账号__表/RDS for MySQL查看表的主键字段的方法.md#)。|
|任务配置的MaxCompute分区字段有误|创建脱敏任务时，在脱敏源配置项中填写的源分区或者目标位置配置项填写的目标分区有误。|

